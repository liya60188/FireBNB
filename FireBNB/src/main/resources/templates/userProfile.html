<!DOCTYPE>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta charset="utf-8" />
<title>User Profile</title>
<div th:insert="fragments/header.html :: links"></div>
</head>

<body>
	<!-- Header -->
	<header th:insert="fragments/header.html :: header"> </header>
	<!-- End of header -->

	<!-- Content -->
	<div class="container-fluid mt-5">
		<div sec:authorize="hasAuthority('USER')" class="row">
			<div class="col-1"></div>
			<!-- Left block -->
			<div class="col-3 border shadow"
				style="background-color: rgba(242, 242, 242);">
				<div class="row">
					<div class="col mt-5 text center">
						<img
							th:src="@{'/user_photos/'+${user.profilePicture}}"
							alt="User picture"
							class="img-fluid border rounded-circle mx-auto d-block"
							style="width: 180px; height: 180px; object-fit: cover;">
					</div>
				</div>

				<div class="row mt-3">
					<div class="col text-center">
						<p>
							<b th:text="${user.firstName} + ' ' + ${user.lastName}"></b>
						</p>
					</div>
				</div>

				<div class="row">
					<div class="col text-center">
						<p>
							<b>About</b>
						</p>
					</div>
				</div>

				<div class="row">
					<div class="col text-justify">
						<p th:text="${user.description}"></p>
					</div>
				</div>

				<div class="row">
					<div class="col">
						<p>
							<b>______</b>
						</p>
					</div>
				</div>

				<div class="row">
					<div class="col text-left">
						<b>Houses</b>
					</div>

					<div class="col text-right">
						<p th:text=${numberOfHouses}></p>
					</div>
				</div>

				<div class="row mt-3">
					<div th:if="${user.email != principal.name}" class="col">
						<a th:href="@{/profile/houses(email=${user.email})}">See
							all houses</a>
					</div>
					<div th:if="${user.email == principal.name}" class="col">
						<a th:href="@{/profile/update(email=${user.email}, type='myProfile')}">
							Edit Profile</a>
					</div>
				</div>
			</div>

			<!-- Right block -->
			<div class="col-7">
				<div class="row">
					<div class="col-3 text-right">
						<b>Total rating :</b>
					</div>
					<!-- CHANGE BY AMANDA -->
					<div class="col-3">
						<span th:text="${user.rating} + '/5'"></span>
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
							fill="currentColor" class="bi bi-star-fill mb-1 ml-1"
							viewBox="0 0 16 16">
  							<path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
						</svg>
						<span th:if="${user.rating == 1}" th:text="${user.ratingSize} + ' rating'"></span>
						<span th:if="${user.rating != 1}" th:text="${user.ratingSize} + ' rating'"></span>
					</div>

					<div class="col text-right">
						<a th:href="@{/rating/add/UserRating/{id_userReceiver}(id_userReceiver=${user.id_user})}">Add
						Rating</a>
					</div>
				</div>

				<div class="row">
					<div class="col mt-5 text-center">
						<h3>
							<b>BEST RATED HOUSES</b>
						</h3>
					</div>
				</div>

<!-- 
				<div class="row" th:each="bestHouses : ${bestHouses}">
					<div th:each=" key : ${bestHouses.key}" th:text="${key.id_house} + ' KEY:'"></div>
					<div th:each=" value : ${bestHouses.value}" th:text="${value}"></div>
				</div>
  -->
				<div class="row">
					<div class="col text-center">
						<img
							src="https://archzine.fr/wp-content/uploads/2016/03/le-belle-photo-image-la-plus-belle-image-du-monde.jpg"
							alt="FireBnB logo" class="img-fluid" width="25%" height="25%">
						<img
							src="https://archzine.fr/wp-content/uploads/2016/03/le-belle-photo-image-la-plus-belle-image-du-monde.jpg"
							alt="FireBnB logo" class="img-fluid ml-5" width="25%"
							height="25%"> <img
							src="https://archzine.fr/wp-content/uploads/2016/03/le-belle-photo-image-la-plus-belle-image-du-monde.jpg"
							alt="FireBnB logo" class="img-fluid ml-5" width="25%"
							height="25%">
					</div>
				</div>
				<div class="row">
					<div class="col mt-5 text-center">
						<h3>
							<b>RATINGS</b>
						</h3>
					</div>
				</div>

				<div class="row" th:each="rating: ${listUserRatings}" var="rating">
					<div class="col text-center">
						<div class="row">
							<div class="col-3">
								<div class="row">
									<div class="col-3"></div>

									<div class="col text-center">
										<img th:src="@{'/user_photos/'+${listRatePhotos.get(rating.id_userSender)}}"
											alt="FireBnB logo"
											class="img-fluid border rounded-circle mx-auto d-block"
											style="width: 85px; height: 85px; object-fit: cover;">
									</div>
								</div>

								<div class="row">
									<div class="col-3"></div>

									<div class="col text-center">
										<a th:text="'By ' + ${listRateNames.get(rating.id_userSender)}"
										th:href="@{/profile(email=${listRateEmails.get(rating.id_userSender)})}"></a>
					
									</div>
								</div>
							</div>

							<div class="col-9 text-justify mt-4">
							
								<span><b th:text="${rating.value} + '/5'"></b></span>
								<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
									fill="currentColor" class="bi bi-star-fill mb-1 ml-1"
									viewBox="0 0 16 16">
		  							<path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
								</svg>
								<p th:text="${rating.description}"></p>
							</div>
						</div>

					</div>
				</div>
				<div class="text-center mt-4">
					<a class="primary-btn" th:href="@{/messagesListUser/sendMessage(email=${user.email}, subject='')}">Send a message</a>
				</div>
			</div>
		</div>
		<div sec:authorize="hasAuthority('ADMIN')" class="row">
 			<div class="col-2 text-left mt-2">
		     	<a th:href= "@{/housesList}" class="text-light">See all houses</a>
		    </div>
		    
		    <div class="col-2 text-left mt-2 mb-0">
		     	<a th:href="@{/usersList}" class="text-light">See all owners</a>
		    </div>
		    
		     <div class="col-2 text-left mt-2 mb-0">
		     	<a th:href="@{/servicesList}" class="text-light">See all services</a>
		    </div>
		    
		     <div class="col-2 text-left mt-2 mb-0">
		     	<a th:href="@{/constraintsList}" class="text-light">See all constraints</a>
		    </div>
		</div>
	</div>
	</div>
	<!-- End of content -->

<!-- Footer -->
<div th:insert="fragments/footer.html :: footer"></div>
<!-- End of Footer -->

</body>
</html>